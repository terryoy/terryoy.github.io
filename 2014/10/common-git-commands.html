<!DOCTYPE html>
<html lang="en"> 
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="Hello, World!" />
    <meta name="application-name" content="Hello, World!" />
    <title>A Guide of Common Git Tasks - Hello, World!</title>
    <meta name="keywords" content="linux,programming" />
    <meta name="description" content="" />
    
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="Hello, World!" />
    <link rel="stylesheet" href="/static/css/styles.css?v=36c6a" />
    <link rel="stylesheet" href="/static/css/pygment_trac.css?v=a6c15" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div id="wrapper">   
<header id="header" class="clear">
    <h1>Hello, World!</h1>
    <p>I'm <i>terryoy</i></p>
    <p class="view"><a href="https://github.com/terryoy">View My GitHub Profile</a></p>
    
    <p><a class="feed" href="/feed.xml">RSS feed</a></p>
</header><!-- #header -->
<nav id="nav" role="navigation">
    <a href="/">Home</a>
    <a href="/guides/">Guides</a>
    <a href="/tricks/">Tricks</a>
    <a href="/projects.html">*Projects</a>
    <a href="/about.html">About Me</a>
</nav>

<section class="main"><article id="main" class="hentry">
	<h1>A Guide of Common Git Tasks</h1>
    <p class="sub_text">2014-10-22 by <i>terryoy</i>, in <a href="/guides/">guides</a>
    </p>
    
	<h3 id="toc_0">1. Initialize a Git project</h3>
<p>Usually, starting a git project include&#39;s the following steps:</p>

<ul>
<li>initialize local repository</li>
<li>add a remote repository from server</li>
<li>set up-stream and push to remote repository</li>
</ul>
<div class="highlight"><pre><span class="c"># initialize a repository</span>
<span class="nv">$ </span>git init

<span class="c"># set a new remote</span>
<span class="nv">$ </span>git remote add origin https://github.com/user/repo.git

<span class="c"># verify new remote</span>
<span class="nv">$ </span>git remote -v

<span class="c"># (you might need to pull origin/master first if it&#39;s not empty)</span>
<span class="nv">$ </span>git pull origin master

<span class="c"># push to remote repository</span>
<span class="nv">$ </span>git push --set-upstream origin master
</pre></div>

<h3 id="toc_1">2. Correct mistakes on the repository</h3>
<p>Usually there are some mistakes we will commit to git repository, so here are a few tips to correct the mistakes:</p>

<ul>
<li>Change file name/path</li>
<li>Unstage files</li>
<li>Remove sensitive data, or binary data in the history </li>
</ul>
<div class="highlight"><pre><span class="c"># change or delete files in the current version</span>
<span class="c"># -- you should not simple use the common shell command &quot;mv&quot; and &quot;rm&quot;, </span>
<span class="c"># -- because that will lose the tracking. You should use with git instead</span>
<span class="nv">$ </span>git rm &lt;somefile&gt;
<span class="nv">$ </span>git mv &lt;somefile&gt; &lt;otherfile&gt;


<span class="c"># Unstage files</span>
<span class="c"># -- usually when you execute &quot;git status&quot;, it will prompt you how to unstage files (e.g. &#39;(use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)&#39;)</span>
<span class="nv">$ </span>git reset HEAD &lt;file&gt;...
<span class="c"># -- (or, in some cases)</span>
<span class="nv">$ </span>git rm --cached &lt;file&gt;

<span class="c"># Remove sensitive data</span>
<span class="c"># -- This one is more difficult. </span>
<span class="c"># check this link: https://help.github.com/articles/remove-sensitive-data/</span>
</pre></div>

<h3 id="toc_2">3. Using Proxy to work with server</h3>
<p>You can use openssh to create an ssh tunnel with a remote server, and then communicate with git server with this tunnel proxy.</p>
<div class="highlight"><pre><span class="c"># Socks</span>
ssh -D &lt;local_proxy_port&gt; &lt;remote_user&gt;@&lt;remote_server&gt; -p &lt;remote_ssh_port&gt;
<span class="c"># HTTPS for one site:</span>
ssh -L &lt;local_proxy_port&gt;:&lt;destination_host&gt;:&lt;destination_port&gt; &lt;ssh_user&gt;@&lt;ssh_server&gt; -p &lt;ssh_port&gt;
</pre></div>
<p>Using git with proxies:</p>
<div class="highlight"><pre><span class="c"># proxy for https</span>
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>&lt;http_proxy_host&gt;:&lt;http_proxy_port&gt;
<span class="c"># socks4 proxy for http</span>
<span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>socks://&lt;socks4_proxy_host&gt;:&lt;socks4_proxy_port&gt;
<span class="c"># socks5 proxy for https</span>
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>socks5://&lt;socks5_proxy_host&gt;:&lt;socks5_proxy_port&gt;
</pre></div>
<p>* If in some blocked environment that can only access HTTP/HTTPS, you can consider changing your ssh service port to 80/443.</p>

<h3 id="toc_3">4. Create a private Git repo on your SSH server</h3>
<p>(reference: <a href="http://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server">git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server</a>)</p>
<div class="highlight"><pre><span class="c"># create a git user for remote access(optional)</span>
<span class="nv">$ </span>sudo adduser git
<span class="nv">$ </span><span class="nb">cd</span> /home/git/ <span class="o">&amp;&amp;</span> mkdir .ssh <span class="o">&amp;&amp;</span> chmod 700 .ssh
<span class="nv">$ </span>touch .ssh/authorized_keys <span class="o">&amp;&amp;</span> chmod 600 .ssh/authorized_keys
<span class="nv">$ </span>cat /tmp/id_rsa.someone.pub &gt;&gt; .ssh/authorized_keys

<span class="c"># create a server repo with </span>
<span class="nv">$ </span>mkdir -p /opt/git/somerepo.git
<span class="nv">$ </span><span class="nb">cd</span> /opt/git/somerepo.git
<span class="nv">$ </span>git init --bare

<span class="c"># create a local git repo(on your PC) and push to server repo</span>
<span class="nv">$ </span><span class="nb">cd </span>myproject
<span class="nv">$ </span>git init
<span class="nv">$ </span>git add . <span class="o">&amp;&amp;</span> git commit -m <span class="s2">&quot;initial commit&quot;</span>
<span class="nv">$ </span>git remote add origin git@gitserver:/opt/git/somerepo.git
<span class="nv">$ </span>git push origin master
</pre></div>

<h3 id="toc_4">5. Tagging</h3>
<div class="highlight"><pre><span class="c"># list your tags</span>
<span class="nv">$ </span>git tag
<span class="c"># search for tags</span>
<span class="nv">$ </span>git tag -l <span class="s2">&quot;v1.8.*&quot;</span>

<span class="c"># create a tag with annotation</span>
<span class="nv">$ </span>git tag -a v1.0.1 -m <span class="s2">&quot;a new tag for v1.0.1&quot;</span>
<span class="c"># create a tag for a previous commit(for example, 902acd...)</span>
<span class="nv">$ </span>git tag -a v1.0.0 902acd

<span class="c"># show tag info</span>
<span class="nv">$ </span>git show v1.0.1

<span class="c"># push a tag to remote server</span>
<span class="nv">$ </span>git push origin v1.0.1
<span class="c"># or push tags</span>
<span class="nv">$ </span>git push origin --tags 

<span class="c"># You can also checkout the tags like the same way you checkout branches</span>
<span class="nv">$ </span>git checkout -b version2 v2.0.0

<span class="c"># delete a tag</span>
<span class="nv">$ </span>git tag -d <span class="s2">&quot;v1.0.1a&quot;</span>
</pre></div>

<h3 id="toc_5">6. Amend Logs</h3>
<div class="highlight"><pre><span class="c"># amend log for the last commit</span>
<span class="nv">$ </span>git commit --amend
</pre></div>

<h3 id="toc_6">7. Working with drafts (stashing)</h3>
<div class="highlight"><pre><span class="c"># Save current uncommitted change to stash</span>
<span class="nv">$ </span>git stash

<span class="c"># List existing stash</span>
<span class="nv">$ </span>git stash list

<span class="c"># recover last stash</span>
<span class="nv">$ </span>git stash apply

<span class="c"># recover previous stashes</span>
<span class="nv">$ </span>git stash apply stash@<span class="o">{</span>1<span class="o">}</span>

<span class="c"># Delete stashes</span>
<span class="nv">$ </span>git stash drop stash@<span class="o">{</span>0<span class="o">}</span>
</pre></div>
<p>Reference for git stash: <a href="https://git-scm.com/docs/git-stash">https://git-scm.com/docs/git-stash</a></p>

<h3 id="toc_7">8. Merge a specific commit to current branch</h3>
<p>Git has a <code>cherry-pick</code> function that can merge a specific commit to the current branch, this save me once. :P</p>
<div class="highlight"><pre><span class="c"># merge a sequence of commits to the current branch, </span>
<span class="nv">$ </span>git cherry-pick &lt;commits...&gt;
</pre></div>
<p>When you try to merge a commit, you will possibly cause some conflict. The cherry-pick function also has some features to help you.</p>
<div class="highlight"><pre><span class="c"># continue the job after you resolve the conflicts</span>
<span class="nv">$ </span>git cherry-pick --continue

<span class="c"># forget current job in the sequence progress</span>
<span class="nv">$ </span>git cherry-pick --quit

<span class="c"># clear all the sequence and recover to the pre-sequence state</span>
<span class="nv">$ </span>git cherry-pick --abort
</pre></div>

<h3 id="toc_8">9. Reverting commits</h3>
<p>There are two types of resetting the branch to a previous state: 1. delete unpublished commits locally, 2. Undo published commits with new commits.</p>
<p>Using <code>git reset</code> can help resetting current state.</p>
<div class="highlight"><pre><span class="c"># delete the unpublished local commits and restore to the previous commit state</span>
<span class="nv">$ </span>git reset --hard &lt;commit&gt;

<span class="c"># if you have local uncommit changes, you should save as stash first</span>
<span class="nv">$ </span>git stash
<span class="nv">$ </span>git reset --hard &lt;commit&gt;
<span class="nv">$ </span>git stash pop
</pre></div>
<p>Using <code>git revert</code> is to make a new commit to revert previous changes(specificly).</p>
<div class="highlight"><pre><span class="c"># cancel specific changes</span>
<span class="nv">$ </span>git revert &lt;commit1&gt; &lt;commit2&gt; ...

<span class="c"># cancel range of commits</span>
<span class="nv">$ </span>git revert e647032...cee8902
<span class="c"># cancel last two commits</span>
<span class="nv">$ </span>git revert HEAD~2...HEAD
</pre></div>
<p><a href="http://stackoverflow.com/questions/4114095/how-to-revert-git-repository-to-a-previous-commit">Ref to git revert</a>.</p>

    
    
	<p/>
	<hr/>
    
    <div class="sub_text">
        <span>Tags:
            <a href="/tag/linux/">linux</a>,&nbsp;<a href="/tag/programming/">programming</a>
		</span>
    
        
    </div>
    

	<p/>
	
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'terryoy';
        var disqus_title = 'A Guide of Common Git Tasks';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
</article></section>

<footer id="footer">
    <p><small>Hosted on GitHub Pages &mdash;<br/> Theme adopted from <a href="https://github.com/orderedlist">orderedlist</a></small></p>
</footer><!-- #footer -->
</div><!-- #wrapper -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50656512-1', 'terryoy.github.io');
ga('send', 'pageview');
</script> <!-- google analytics -->

</body>
</html>